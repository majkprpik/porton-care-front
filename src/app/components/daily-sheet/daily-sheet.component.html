<div class="daily-sheet-container">
  <!-- Left side - Task Cards -->
  <div class="tasks-section">
    <div class="header">
      <h3>Tasks</h3>
      
      <div class="list-grid-icons">
        <div 
          class="list-view-container" 
          (click)="toggleListGridView('list')" 
          [ngStyle]="{'background-color': listGridView === 'list' ? 'white' : 'transparent'}"
        >
          <mat-icon>view_list</mat-icon>
        </div>
        <div 
          class="grid-view-container" 
          (click)="toggleListGridView('grid')"
          [ngStyle]="{'background-color': listGridView === 'grid' ? 'white' : 'transparent'}"
        >
          <mat-icon>grid_on</mat-icon>
        </div>
      </div>
    </div>

    <div
      class="tasks-list"
      cdkDropList
      id="tasks-list"
      [cdkDropListData]="taskCards"
      [cdkDropListConnectedTo]="getTeamTaskDropLists()"
      (cdkDropListDropped)="onDrop($event)"
      *ngIf="listGridView == 'grid'"
    >
      <div 
        class="task-card"
        *ngFor="let task of taskCards"
        cdkDrag
        [ngClass]="{'task-available': task.taskProgressType === 'Nije dodijeljeno'}"
      >
      <div class="task-number">{{ task.houseNumber }}</div>
      <mat-icon class="task-indicator">{{ getTaskIndicator(task) }}</mat-icon>
      </div>
      <div class="placeholder" *ngIf="taskCards.length === 0">
        No tasks available
      </div>
    </div>
    
    <ng-container *ngIf="listGridView == 'list'">
      <div *ngFor="let filteredTaskType of filteredTaskTypes">
        <div class="title-container" (click)="toggleExpandMinimize(filteredTaskType.task_type_name)">
          <h3>{{ filteredTaskType.task_type_name }}</h3>
          
          <mat-icon *ngIf="!expandedSections[filteredTaskType.task_type_name]" id="minimize-icon">minimize</mat-icon>
          <mat-icon *ngIf="expandedSections[filteredTaskType.task_type_name]" id="expand-icon">crop_square</mat-icon>
        </div>
        <div
          class="tasks-list"
          cdkDropList
          id="tasks-list-{{filteredTaskType.task_type_name}}"
          [cdkDropListData]="taskCards | tasksFilter: [filteredTaskType.task_type_name]"
          [cdkDropListConnectedTo]="getAllDropLists()"
          (cdkDropListDropped)="onDrop($event)"
          [ngStyle]="{'display': !expandedSections[filteredTaskType.task_type_name] ? 'flex' : 'none'}"
        >
          <div 
            class="task-card"
            *ngFor="let task of taskCards | tasksFilter: [filteredTaskType.task_type_name]"
            cdkDrag
            [ngClass]="{'task-available': task.taskProgressType === 'Nije dodijeljeno'}"
          >
            <div class="task-number">{{ task.houseNumber }}</div>
            <mat-icon class="task-indicator">{{ getTaskIndicator(task) }}</mat-icon>
            
            <!-- Custom drag preview -->
            <ng-template cdkDragPreview>
              <div class="task-card task-card-preview">
                <div class="task-number">{{ task.houseNumber }}</div>
                <mat-icon class="task-indicator">{{ getTaskIndicator(task) }}</mat-icon>
              </div>
            </ng-template>
          </div>
          <div class="placeholder" *ngIf="(taskCards | tasksFilter: [filteredTaskType.task_type_name]).length === 0">
            No tasks available
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Middle - Teams -->
  <div class="teams-section">
    <div class="teams-header">
      <h3>Teams</h3>
      <div class="teams-actions">
        <button class="new-team-btn" (click)="createNewTeam()">
          Create New Team
        </button>
        <button class="publish-btn" (click)="publishTeams()">Publish</button>
      </div>
    </div>

    <div class="teams-container">
      <div *ngIf="assignedTeams.length === 0" class="no-teams-message">
        No teams found for today. Create a new team to get started.
      </div>
      
      <div class="team-box" *ngFor="let team of assignedTeams">
        <h4>Team {{ team.id }} <span *ngIf="isTeamLocked(team.id)" class="locked-indicator">(Locked)</span></h4>
        <div class="team-content" [ngClass]="{'locked': isTeamLocked(team.id)}">
          <div
            class="team-tasks"
            cdkDropList
            [id]="'team-' + team.id + '-tasks'"
            [cdkDropListData]="team.tasks"
            [cdkDropListConnectedTo]="getAllDropLists()"
            (cdkDropListDropped)="onDrop($event)"
            [cdkDropListDisabled]="isTeamLocked(team.id)"
          >
            <div 
              class="task-card"
              *ngFor="let task of team.tasks"
              cdkDrag
              [cdkDragDisabled]="isTeamLocked(team.id)"
              [ngClass]="{'task-available': task.taskProgressType === 'Nije dodijeljeno'}"
            >
            <div class="task-number">{{ task.houseNumber }}</div>
              <mat-icon class="task-indicator">{{ getTaskIndicator(task) }}</mat-icon>
              
              <!-- Custom drag preview -->
              <ng-template cdkDragPreview>
                <div class="task-card task-card-preview">
                  <div class="task-number">{{ task.houseNumber }}</div>
                  <mat-icon class="task-indicator">{{ getTaskIndicator(task) }}</mat-icon>
                </div>
              </ng-template>
            </div>
            <div class="placeholder" *ngIf="team.tasks.length === 0">
              Drop tasks here
            </div>
          </div>

          <div
            class="team-members"
            cdkDropList
            [id]="'team-' + team.id + '-members'"
            [cdkDropListData]="team.members"
            [cdkDropListConnectedTo]="isTeamLocked(team.id) ? [] : ['staff-list']"
            (cdkDropListDropped)="onDrop($event)"
            [cdkDropListDisabled]="isTeamLocked(team.id)"
          >
            <div
              class="member-card"
              *ngFor="let member of team.members"
              cdkDrag
              [cdkDragDisabled]="isTeamLocked(team.id)"
            >
              {{ member.name }}
            </div>
            <div class="placeholder" *ngIf="team.members.length === 0">
              Drop staff here
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Right side - Cleaning Staff -->
  <div class="staff-section">
    <h3>Available Cleaning Staff</h3>
    <div
      class="staff-list"
      cdkDropList
      id="staff-list"
      [cdkDropListData]="availableStaff"
      [cdkDropListConnectedTo]="getTeamMemberDropLists()"
      (cdkDropListDropped)="onDrop($event)"
    >
      <div
        class="staff-card"
        *ngFor="let person of availableStaff"
        cdkDrag
        [class.unavailable]="!person.available"
      >
        {{ person.name }}
      </div>
      <div class="placeholder" *ngIf="availableStaff.length === 0">
        No available staff members
      </div>
    </div>
  </div>
</div>